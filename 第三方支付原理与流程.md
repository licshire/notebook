### 第三方支付原理与流程

###### 支付原理

![image](http://www.songlin51.com/wp-content/uploads/2012/10/%E5%9B%BE%E7%89%871.png)

以上简要说明了支付过程，当然其中省略了一些步骤（比如购物车，订单等），我们重点来看支付流程。

##### 支付流程

1. 用户向商城网站发起确认订单的请求

2. 商城网站接收到请求保存订单数据到数据库或其他存储介质

3. 返回订单确认页面，页面上应该显示订单金额等信息

4. 用户确认支付，发起支付请求。注：支付请求是发送到支付网关（比如支付宝、网银在线）而不是发送到商城网站。

5. 显示支付页面

6. 用户填写认证信息（账号密码等）提交

7. 这里有两个步骤一个是扣款成功后页面跳转到支付结果页面（展示给用户），另一个是支付通知，这两步没有先后顺序可能同时执行，商城网站接收到支付通知后根据验证规则验证信息的有效性，并作出相应的更改操作（例：有效则更改订单为已付款状态，无效则记录非法请求信息）。

##### 以支付宝为例：

如果实现在网站中集成支付宝接口，首先要有一个**支付宝账号**，接下来向支付宝申请在线支付业务，签署协议。协议生效后有支付宝一方会给网站方一个**合作伙伴ID**，和**安全校验码**，有了这两样东西就可以按照支付宝接口文档开发支付宝接口了，在上图的几个步骤中只有4和7两个步骤在商城与支付网关之间有信息交互。在步骤4中指将数据发送到支付网关（支付宝），在步骤7中是的通知验证部分，验证网关请求网站某地址，网站按验证规则对信息进行验证记录并作出响应，我们几乎在开发任何支付接口时，重点是这两部分的开发，明白支付接口原理，开发支付接口就不难了。